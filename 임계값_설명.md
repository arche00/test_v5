# 시뮬레이션 임계값 설정 설명

## 1. 시뮬레이션에서 사용하는 두 가지 임계값

### main_threshold (메인 임계값)
- **역할**: 예측을 **시도**할 신뢰도 기준
- **기본값**: 
  - 단일 파라미터 모드: UI에서 설정 (기본값 56%)
  - 다차원 최적화 모드: session_state에서 가져오거나 기본값 56% 사용
- **동작**:
  - `predict_with_fallback_interval` 함수에서 먼저 이 임계값으로 예측 시도
  - 신뢰도가 main_threshold **이상**이면 → 예측 수행 (is_forced=False)
  - 신뢰도가 main_threshold **미만**이면 → 예측 없음
- **다차원 최적화 적용**: ✅ **적용됨** (모든 조합 테스트 시 동일한 main_threshold 사용)

### confidence_skip_threshold (스킵 임계값)
- **역할**: 강제 예측을 **스킵**할 신뢰도 기준
- **시뮬레이션 결과 예**: 53.5%
- **동작**:
  - 최대 간격(max_interval)을 넘겨서 강제 예측(is_forced=True)이 발생했을 때
  - 강제 예측의 신뢰도가 confidence_skip_threshold **미만**이면 → 스킵 (예측하지 않음)
  - 강제 예측의 신뢰도가 confidence_skip_threshold **이상**이면 → 예측 수행
- **다차원 최적화 적용**: ✅ **적용됨** (각 조합마다 다른 confidence_skip_threshold 테스트)

## 2. 예시: 윈도우 크기=8, 최대 간격=6, 스킵 임계값=53.5%

### 시나리오: 현재 신뢰도 54% 강제 예측이 나온 경우

```
1단계: predict_with_fallback_interval 호출
   - main_threshold=56%로 예측 시도
   - 신뢰도 54% → 56% 미만이므로 예측값 없음

2단계: 최대 간격 확인
   - current_interval (예측 없음 횟수) 확인
   - current_interval >= max_interval(6)이면 → 강제 예측

3단계: 강제 예측 수행
   - 임계값 없이 예측 → 신뢰도 54% 강제 예측 결과
   - is_forced = True

4단계: 스킵 규칙 확인
   - is_forced=True이고 신뢰도(54%) < confidence_skip_threshold(53.5%)?
   - ❌ 54% >= 53.5%이므로 스킵하지 않음
   - ✅ 예측을 수행함!
```

### 핵심 정리
- **54% 강제 예측**은 **53.5% 이상**이므로 스킵하지 않고 예측합니다
- 최대 간격이 충족되어 강제 예측이 발생했고, 그 신뢰도가 스킵 임계값 이상이면 예측합니다

## 3. 라이브 게임에서의 설정

### 현재 설정 항목
1. **임계값 (main_threshold)**: 기본값 56%
   - 예측 시도 기준
   
2. **신뢰도 스킵 임계값 (confidence_skip_threshold)**: 기본값 51.5%
   - 강제 예측 스킵 기준

### 시뮬레이션 결과와의 관계

시뮬레이션 결과가:
- 윈도우 크기=8
- 최대 간격=6
- **스킵 임계값=53.5%** (시뮬레이션 결과의 "임계값")

라이브 게임 설정:
- **임계값 (main_threshold)**: 시뮬레이션에서 사용한 값 (기본 56% 또는 설정값)
- **신뢰도 스킵 임계값 (confidence_skip_threshold)**: **53.5%** (시뮬레이션 결과값과 동일)

## 5. 왜 두 임계값이 분리되어 있는가?

### main_threshold (높은 값, 예: 56%)
- 목적: **높은 신뢰도의 예측만** 선별적으로 수행
- 효과: 불확실한 예측을 피하고 정확도가 높은 예측만 사용

### confidence_skip_threshold (낮은 값, 예: 53.5%)
- 목적: 강제 예측 중에서도 **너무 낮은 신뢰도는 스킵**
- 효과: 최대 간격을 넘겨서 강제 예측이 필요할 때도, 너무 낮은 신뢰도는 피함

## 6. 동작 흐름도

```
[스텝 시작]
    ↓
main_threshold(56%)로 예측 시도
    ↓
신뢰도 >= 56%?
    ├─ 예 → 예측 수행 (is_forced=False) → 검증
    └─ 아니오 → 예측 없음
                ↓
            current_interval 증가
                ↓
            current_interval >= max_interval(6)?
                ├─ 예 → 강제 예측 (is_forced=True)
                │         ↓
                │       신뢰도 확인
                │         ↓
                │       신뢰도 < confidence_skip_threshold(53.5%)?
                │         ├─ 예 → 스킵 (예측 안 함)
                │         └─ 아니오 → 예측 수행 → 검증
                └─ 아니오 → 예측 없음, 다음 스텝
```

## 7. 사용자 질문 답변

### Q1: 53.5%는 임계값과 스킵 모드를 모두 사용하는 건가?
**A**: 아니요. 53.5%는 **스킵 임계값(confidence_skip_threshold)**만 의미합니다.
- 임계값(main_threshold)은 시뮬레이션 설정에서 별도로 지정 (기본값 60%)

### Q2: 라이브 게임에서 같은 값으로 설정해야 하는가?
**A**: 
- **신뢰도 스킵 임계값**: 시뮬레이션 결과값(53.5%)과 동일하게 설정 ✅
- **임계값 (main_threshold)**: 시뮬레이션에서 사용한 값과 동일하게 설정 ✅

### Q3: 54% 예측값이 있을 때 최대 간격이 충족되지 않아도 예측하는 게 맞는가?
**A**: 맞습니다! 
- 54% > 53.5%이므로 스킵하지 않습니다
- 최대 간격 조건으로 강제 예측이 발생했고, 신뢰도가 스킵 임계값 이상이므로 예측을 수행합니다
- 다만, 최대 간격을 넘지 않았다면 강제 예측 자체가 발생하지 않습니다
